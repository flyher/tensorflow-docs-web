<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Embeddings</title>
    <link rel="stylesheet" href="//tensorflow.juejin.im/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="//tensorflow.juejin.im/assets/css/highlight.js.min.css">
    <link rel="stylesheet" href="//tensorflow.juejin.im/assets/css/needsharebutton.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" href="//tensorflow.juejin.im/assets/css/main.css">
</head>
<body>
<!-- Header start -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="//tensorflow.juejin.im">TensorFlow</a>
    <button class="navbar-toggler" type="button" aria-expanded="false" aria-label="Menu"
            onclick="$('.collapse').toggle()">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
        </ul>
        <form class="form-inline my-2 my-lg-0 my-md-0">
            <input class="form-control mr-sm-2" id="search" type="search" placeholder="Search" aria-label="Search">
        </form>
    </div>
</nav>
<script>
    var head = [{'link': '//tensorflow.juejin.im/extend/index.html', 'name': '扩展', 'selected': 0}, {'link': '//tensorflow.juejin.im/install/index.html', 'name': '安装 TensorFlow', 'selected': 0}, {'link': '//tensorflow.juejin.im/deploy/index.html', 'name': '部署', 'selected': 0}, {'link': '//tensorflow.juejin.im/about/index.html', 'name': '关于 TensorFlow', 'selected': 0}, {'link': '//tensorflow.juejin.im/get_started/index.html', 'name': '开始', 'selected': 0}, {'link': '//tensorflow.juejin.im/mobile/index.html', 'name': '概述', 'selected': 0}, {'link': '//tensorflow.juejin.im/tutorials/index.html', 'name': '教程', 'selected': 0}, {'link': '//tensorflow.juejin.im/javascript/index.html', 'name': 'JavaScript', 'selected': 0}, {'link': '//tensorflow.juejin.im/performance/index.html', 'name': '性能', 'selected': 0}, {'link': '//tensorflow.juejin.im/community/index.html', 'name': '社区', 'selected': 0}, {'link': '//tensorflow.juejin.im/programmers_guide/index.html', 'name': '开发者指南', 'selected': 1}]
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92630037-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92630037-8');
</script>

<!-- Header end -->

<!-- Content start-->
<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
    <div class="sidebar-sticky" id="left-nav">

    </div>
</nav>
<script>
    var nav = [{'type': 'child', 'link': '//tensorflow.juejin.im/programmers_guide/index.html', 'title': '开发者指南'}, {'type': 'parent', 'title': ' High Level APIs', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/eager.html', 'title': 'Eager Execution'}, {'link': '//tensorflow.juejin.im/programmers_guide/datasets.html', 'title': '数据导入'}, {'link': '//tensorflow.juejin.im/programmers_guide/estimators.html', 'title': '评估器'}]}, {'type': 'parent', 'title': ' Low Level APIs', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/low_level_intro.html', 'title': '底层 API 编程介绍'}, {'link': '//tensorflow.juejin.im/programmers_guide/tensors.html', 'title': '张量'}, {'link': '//tensorflow.juejin.im/programmers_guide/variables.html', 'title': '变量'}, {'link': '//tensorflow.juejin.im/programmers_guide/graphs.html', 'title': '流图与会话'}, {'link': '//tensorflow.juejin.im/programmers_guide/saved_model.html', 'title': '保存和恢复'}]}, {'type': 'parent', 'title': ' Accelerators', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/using_gpu.html', 'title': '使用（多个）GPU'}, {'link': '//tensorflow.juejin.im/programmers_guide/using_tpu.html', 'title': '使用 TPU'}]}, {'type': 'parent', 'title': ' ML Concepts', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/embedding.html', 'title': 'Embeddings'}]}, {'type': 'parent', 'title': ' Debugging', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/debugger.html', 'title': 'TensorFlow 调试器'}]}, {'type': 'parent', 'title': ' TensorBoard', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/summaries_and_tensorboard.html', 'title': 'Tensorboard：可视化学习面板'}, {'link': '//tensorflow.juejin.im/programmers_guide/graph_viz.html', 'title': 'TensorBoard: 图形可视化'}, {'link': '//tensorflow.juejin.im/programmers_guide/tensorboard_histograms.html', 'title': 'TensorBoard 直方图面板'}]}, {'type': 'parent', 'title': ' Misc', 'sub_class': [{'link': '//tensorflow.juejin.im/programmers_guide/version_compat.html', 'title': 'TensorFlow 版本兼容性'}, {'link': '//tensorflow.juejin.im/programmers_guide/faq.html', 'title': '常见问题'}]}]
</script>
        <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content">
            <h1 id="toc-0">Embeddings</h1>
<p>本文档介绍了 embeddings 的概念，给出了如何在 TensorFlow 中对 embedding 进行训练的简单示例，并解释了如何使用 TensorBoard Embedding Projector (<a href="http://projector.tensorflow.org">live example</a>) 查看 embeddings。前两部分是针对机器学习和 TensorFlow 的新手，而 Embedding Projector 则是针对所有水平的用户。</p>
<p>有关这些概念的另一个教程可以在<a href="https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture">机器学习速成课程的 Embeddings 部分</a>中找到。</p>
<p>[TOC]</p>
<p><strong>Embedding</strong> 是从离散对象（如单词）到实数向量的映射。例如，英文单词的 300 维 embedding 可以如下所示：</p>
<pre><code>blue:  (0.01359, 0.00075997, 0.24608, ..., -0.2524, 1.0048, 0.06259)
blues:  (0.01396, 0.11887, -0.48963, ..., 0.033483, -0.10007, 0.1158)
orange:  (-0.24776, -0.12359, 0.20986, ..., 0.079717, 0.23865, -0.014213)
oranges:  (-0.35609, 0.21854, 0.080944, ..., -0.35413, 0.38511, -0.070976)
</code></pre>
<p>这些向量中的各个维度通常没有固定的意义。相反，机器学习利用的是向量之间的位置和距离的整体模式。</p>
<p>Embeddings 对于机器学习的输入非常重要。分类器（更普遍的包括神经网络）基于实数向量运行。它们在密集向量（这个向量中的所有值对对象的定义都有意义）上训练模型的最佳方式。然而，对于机器学习中很多重要的输入，比如文本中的文字，并没有自然的向量表示。Embedding 函数是将这些离散的输入对象转换为可用连续向量的业界标准做法。</p>
<p>Embeddings 作为机器学习的输出也同样很有价值。由于 embeddings 是将对象映射到向量上，应用程序可以使用向量空间中的相似性（例如，欧几里得度量或向量夹角）作为对象间相似度健壮而灵活的度量工具。一个常见的用途就是找出最近元素。例如，使用与上面相同的单词 embeddings，这里是每个单词的三个最近元素和相应的向量夹角：</p>
<pre><code>blue:  (red, 47.6°), (yellow, 51.9°), (purple, 52.4°)
blues:  (jazz, 53.3°), (folk, 59.1°), (bluegrass, 60.6°)
orange:  (yellow, 53.5°), (colored, 58.0°), (bright, 59.9°)
oranges:  (apples, 45.3°), (lemons, 48.3°), (mangoes, 50.4°)
</code></pre>
<p>应用程序能从这些数据中推测出在某些方面苹果和橙子（相距 45.3°）比柠檬和橙子（相距 48.3°）更相似。</p>
<h2 id="toc-1">在 TensorFlow 中使用 embeddings</h2>
<p>要在 TensorFlow 中创建 embeddings，我们首先将文本拆分成单词，然后为词汇表中的每个单词分配一个整数。让我假设这已经完成了，并且 <code>word_ids</code> 是这些整数的一个向量。例如，“I have a cat.” 这句话可以被拆分成 <code>[“I”, “have”, “a”, “cat”, “.”]</code>，然后相应的 <code>word_ids</code> tensor 会具备维度 <code>[5]</code> 并由 5 个整数组成，我们需要创建 embeddings 变量并像下面一样使用 <code>tf.nn.embedding_lookup</code> 函数：</p>
<pre><code>word_embeddings = tf.get_variable(“word_embeddings”,
    [vocabulary_size, embedding_size])
embedded_word_ids = tf.nn.embedding_lookup(word_embeddings, word_ids)
</code></pre>
<p>在此之后，在我们的例子中 tensor <code>embedded_word_ids</code> 会具备维度 <code>[5, embedding_size]</code>，其中就是这 5 个单词的每一个词的 embeddings（密集向量）。在训练结束时，<code>word_embeddings</code> 将包含词汇表中所有单词的 embeddings。</p>
<p><a href="//tensorflow.juejin.im/tutorials/word2vec.html">单词的向量表示</a></p>
<h2 id="toc-2">将 Embeddings 可视化</h2>
<p>TensorBoard 包含了 <strong>Embedding Projector</strong>，一个让你能够交互式查看 embeddings 的工具。这个工具可以从你的模型中读取 embeddings 并将它们渲染到二维或三维空间中。</p>
<p>Embedding Projector 有三个面板：</p>
<ul>
<li>Data panel 在顶部左侧，这里你可以选择运行，通过点击改变 embedding 变量，和数据列颜色或将他们打上标签。</li>
<li>Projections panel 在底部左侧，在这里你可以选择展示的类型。</li>
<li>Inspector panel 在右侧，这里你可以查询特殊的点并查看最近元素列表。</li>
</ul>
<h3 id="toc-3">Projections</h3>
<p>Embedding Projector 为数据集降维提供了三种方法。</p>
<ul>
<li><p><strong><a href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding">t-SNE</a></strong>：一个非线性的不确定算法，通常是以扭曲全局结构为代价试图保留数据中的局部邻域。你可以选择是否计算为二维或三维的展示。</p>
</li>
<li><p><strong><a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a></strong>：一个线性的确定算法（主成分分析），试图在尽可能少的维度上捕获尽可能多的数据可变性。PCA 倾向于从数据中发现大规模结构，但可能会扭曲局部邻域。Embedding Projector 计算前 10 个主要组件，你可以从中选择两个或三个来查看。</p>
</li>
<li><p><strong>Custom</strong>：使用数据中的标签，得到一条在你指定的水平和垂直轴上的线性映射。例如，你通过给定的文本模式“ Left ”与“ Right ”指定水平轴，Embedding Projector 找出所有被“ Left ”模式匹配到的点，并计算该组的质心；“ Right ”也是类似。通过这两点的直线定义为水平轴。对于“ UP ”和“ DOWN ”文本模式，垂直轴也是类似的计算出两个点集的质心得出。</p>
</li>
</ul>
<p>获取其他有价值文章可以查看 <a href="https://distill.pub/2016/misread-tsne/">How to Use t-SNE Effectively</a> 和 <a href="http://setosa.io/ev/principal-component-analysis/">Principal Component Analysis Explained Visually</a>。</p>
<h3 id="toc-4">探索</h3>
<p>你可以通过单击和拖动自然地进行缩放、旋转、平移来直观的探索。将鼠标悬停在点上将显示该点的任何<a href="#元数据">元数据</a>。你也可以检查最近元素的子集。点击一个点会在右窗格列出最近的元素，以及到当前点的距离。展示区域中也突出显示最近邻点。</p>
<p>有时候我们只需要观察点集的一部分，将视图聚焦在这一部分上是非常有帮助的。为此，你可以通过多种方式选择点：</p>
<ul>
<li>点击一个点后，最近的元素也会被选择。</li>
<li>搜索后，选中匹配的的点集。</li>
<li>启用选择，单击一个点并拖动定义一个选择范围。</li>
</ul>
<p>然后点击右侧检查器面板顶部的“ Isolate <strong>nnn</strong> points ”按钮，下图显示了 101 个被选中的点，并且" Isolate 101 points "可供用户点击。</p>
<p><img src="https://www.tensorflow.org/images/embedding-nearest-points.png" alt="选中最近的相邻元素" title="Selection of nearest neighbors"></p>
<p><strong>在文字 embedding 数据集中选中" import "的最近相邻元素。</strong></p>
<p>提示：使用选中功能来自定义展示很强大。下面，我们选择了“ politics ”的最近的 100 个相邻元素并将他们映射到“ worst ”-“ best ”向量作为的 X 轴上。Y 轴是随机的。因此，在右边是“ ideas ”、“ science ”、“ perspective ”、“ journalism ”，而在左边则是” crisis “、“ violence ”和“ conflict ”。</p>
<table width="100%;">
  <tr>
    <td style="width: 30%;">
      <img src="https://www.tensorflow.org/images/embedding-custom-controls.png" alt="Custom controls panel" title="Custom controls panel" />
    </td>
    <td style="width: 70%;">
      <img src="https://www.tensorflow.org/images/embedding-custom-projection.png" alt="Custom projection" title="Custom projection" />
    </td>
  </tr>
  <tr>
    <td style="width: 30%;">
      projection 自定义控制。
    </td>
    <td style="width: 70%;">
      "politics" 在 "best" - "worst" 向量上定制的 projection。
    </td>
  </tr>
</table><p>如果你想要分享你的发现，可以使用右下角的书签面板，并将当前状态（包括任何展示栏中的计算坐标）保存为小文件。然后可以将  Projector 指向一组这样一个或多个的文件，制作下面的板块。其他用户就可以查看这一系列书签了解它们。</p>
<p><img src="https://www.tensorflow.org/images/embedding-bookmark.png" alt="Bookmark panel" style="width:300px;"></p>
<h3 id="toc-5">元数据</h3>
<p>如果你正在使用 embedding，则可能需要将坐标/图像附加到数据点上。你可以通过生成包含每个点标签的元数据文件，然后在 Embedding Projector 的数据面板中单击“Load data”来执行操作。</p>
<p>元数据可以是标签或图像，它们储存在单独的文件中。对于标签，格式应该是 <a href="https://en.wikipedia.org/wiki/Tab-separated_values">TSV file</a>（表示为红色的制表符），其第一行包含列标题（以粗体显示），后续行包含元数据值。例如：</p>
<p><code>
<b>Word<span style="color:#800;">\t</span>Frequency</b><br/>
  Airplane<span style="color:#800;">\t</span>345<br/>
  Car<span style="color:#800;">\t</span>241<br/>
  ...
</code></p>
<p>除标题外，元数据文件中行的顺序与 embedding 变量中的向量的顺序应该是相匹配的。因此，元数据文件中的第（i + 1）行对应于 embedding 变量的第 i 行。如果 TSV 元数据文件只有一个列，并假设每一行都是 embedding 的标签。这是一个特外，但它确实符合常用的“ vocab file ”格式。</p>
<p>要将图片用作元数据，你必须制作一个 <a href="https://www.google.com/webhp#q=what+is+a+sprite+image">sprite image</a>，其中包含小缩略图，在 embedding 过程中一个该文件可供每个向量使用。它应该按行先存储缩略图：第一个数据点放在左上角，尽管最后一行不需要填充，最后一个数据点放在右下角，如下图所示。</p>
<table style="border: none;">
<tr style="background-color: transparent;">
  <td style="border: 1px solid black">0</td>
  <td style="border: 1px solid black">1</td>
  <td style="border: 1px solid black">2</td>
</tr>
<tr style="background-color: transparent;">
  <td style="border: 1px solid black">3</td>
  <td style="border: 1px solid black">4</td>
  <td style="border: 1px solid black">5</td>
</tr>
<tr style="background-color: transparent;">
  <td style="border: 1px solid black">6</td>
  <td style="border: 1px solid black">7</td>
  <td style="border: 1px solid black"></td>
</tr>
</table><p>打开<a href="&quot;https://www.tensorflow.org/images/embedding-mnist.mp4&quot;">这个链接</a>查看一个有趣的 Embedding Projector 中图像缩略图案例。</p>
<h2 id="toc-6">小型问答会</h2>
<p><strong>“embedding” 是一个操作还是一个对象？</strong><br>
都是，人们讨论在一个矢量空间中 embedding 词语（操作）和生成单词 embedding（对象）。两者共同点在于 embedding 的概念都是将离散对象映射到矢量的过程。创建或者应用映射是一个操作，但映射本身是一个对象。</p>
<p><strong>embedding 是高维还是低维？</strong><br>
这不一定。例如，与包括数百万个单词和短语的矢量空间相比，只包含 300 维的矢量空间通常只能被称为低维的（并且密集）。但在数学意义上，它是高维的，显示出许多与我们人类直觉了解的二维和三维空间截然不同的特性。</p>
<p><strong>embedding 和 embedding 层是一样的吗？</strong><br>
不是，<strong>embedding 层</strong>是神经网络的一部分，而 <strong>embedding</strong> 则是一个普通的概念。</p>

        </main>
        <div class="d-none d-xl-block col-xl-2 bd-toc">
        <ul id="table-of-content">
<li><a href="#toc-0">Embeddings</a><ul>
<li><a href="#toc-1">在 TensorFlow 中使用 embeddings</a></li>
<li><a href="#toc-2">将 Embeddings 可视化</a></li>
<li><a href="#toc-6">小型问答会</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>
<!-- Content end-->

<!-- Footer start -->
<footer class="footer">
    <div class="container">
        <div>如果您发现本页面存在错误或可以改进，请<a href="https://github.com/xitu/tensorflow-docs/blob/zh-hans/programmers_guide/embedding.md" target="_blank">点击此处</a>帮助我们改进。本页贡献者：<span id="contributors"></span></div>
        <hr/>
        <div class="text-center official-links">
            <a href="https://www.tensorflow.org"><img
                    src="https://www.tensorflow.org/_static/b1fb9a8564/images/tensorflow/lockup.png" height="20"/></a>
            <a href="https://github.com/xitu/tensorflow-docs"><img
                    src="https://assets-cdn.github.com/images/modules/logos_page/GitHub-Logo.png" height="20"></a>
            <a href="https://juejin.im"><img src="//tensorflow.juejin.im/assets/imgs/logo_app_white.png" height="20"/></a>
        </div>
    </div>
</footer>
<script>
    var contributors = [{'JohnJiangLA': 'https://avatars3.githubusercontent.com/u/6165782?v=4'}, {'leviding': 'https://avatars3.githubusercontent.com/u/26959437?v=4'}]
</script>
<!-- Footer end -->
<div id="share-button" data-share-position="middleRight" data-share-icon-style="box" data-share-networks="Wechat,Twitter,RenRen,Facebook,GooglePlus" data-share-title="Embeddings">
    <img src="//tensorflow.juejin.im/assets/imgs/share.png"/>
</div>
</body>
<script src="//tensorflow.juejin.im/assets/js/jquery.slim.min.js" type="text/javascript"></script>
<script src="//tensorflow.juejin.im/assets/js/highlight.min.js" type="text/javascript"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script src="//tensorflow.juejin.im/assets/js/needsharebutton.js" type="text/javascript"></script>
<script src="//tensorflow.juejin.im/assets/js/main.js" type="text/javascript"></script>
</html>